{% comment %}
  Science Page — Research Articles
  Dynamically pulls articles from the Shopify blog and renders as content cards.
  Placed between Quality and Sourcing sections on the Science page.
{% endcomment %}

{%- assign blog_handle = section.settings.blog | default: 'news' -%}
{%- assign target_blog = blogs[blog_handle] -%}

{% if target_blog.articles_count > 0 %}
<section class="optibio-articles optibio-page-section">
  <div class="optibio-page-section__inner">
    <h2 class="optibio-page-section__heading">{{ section.settings.heading }}</h2>
    <p class="optibio-page-section__subheading">{{ section.settings.subheading }}</p>

    <div class="optibio-articles__grid">
      {% for article in target_blog.articles limit: section.settings.articles_count %}
        <a href="{{ article.url }}" class="optibio-articles__card">
          <div class="optibio-articles__card-badge">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            {{ section.settings.badge_text | default: 'Research Article' }}
          </div>

          {% if article.image %}
            <div class="optibio-articles__card-image">
              <img
                src="{{ article.image | image_url: width: 600 }}"
                alt="{{ article.image.alt | default: article.title | escape }}"
                width="600"
                height="340"
                loading="lazy"
              >
            </div>
          {% endif %}

          <h3 class="optibio-articles__card-title">{{ article.title }}</h3>

          <p class="optibio-articles__card-excerpt">
            {{ article.content | strip_html | truncatewords: 30 }}
          </p>

          <div class="optibio-articles__card-meta">
            <span>{{ article.published_at | date: '%B %d, %Y' }}</span>
            <span>{{ article.content | strip_html | split: ' ' | size }} words</span>
          </div>

          <span class="optibio-articles__card-link">
            Read Full Article →
          </span>
        </a>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .optibio-articles {
    background: linear-gradient(180deg, #FFFFFF 0%, #F8FAFC 100%);
  }

  .optibio-articles__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
  }

  .optibio-articles__card {
    background: #FFFFFF;
    border: 1px solid #E2E8F0;
    border-radius: 16px;
    padding: 0;
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: inherit;
  }

  .optibio-articles__card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(30, 58, 95, 0.1);
  }

  .optibio-articles__card-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    background: linear-gradient(135deg, #EFF6FF, #DBEAFE);
    border: 1px solid #BFDBFE;
    border-radius: 8px;
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    font-weight: 600;
    color: #1E40AF;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    align-self: flex-start;
    margin: 24px 24px 0;
  }

  .optibio-articles__card-image {
    margin: 16px 24px 0;
    border-radius: 10px;
    overflow: hidden;
  }

  .optibio-articles__card-image img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    display: block;
  }

  .optibio-articles__card-title {
    font-family: 'Sora', sans-serif;
    font-size: 18px;
    font-weight: 700;
    color: #1A2F4D;
    line-height: 1.3;
    margin: 16px 24px 0;
  }

  .optibio-articles__card-excerpt {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    line-height: 1.6;
    color: #475569;
    margin: 12px 24px 0;
    flex-grow: 1;
  }

  .optibio-articles__card-meta {
    display: flex;
    gap: 16px;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    color: #94A3B8;
    margin: 16px 24px 0;
  }

  .optibio-articles__card-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #2563EB;
    text-decoration: none;
    transition: color 0.2s ease;
    margin: 16px 24px 24px;
  }

  .optibio-articles__card:hover .optibio-articles__card-link {
    color: #1D4ED8;
  }

  @media (max-width: 1024px) {
    .optibio-articles__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .optibio-articles__grid {
      grid-template-columns: 1fr;
    }

    .optibio-articles__card-title {
      font-size: 16px;
    }
  }
</style>
{% endif %}

{% schema %}
{
  "name": "Research Articles",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Research & Education"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Dive deeper into the science behind ashwagandha, KSM-66®, and evidence-based wellness."
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Card Badge Text",
      "default": "Research Article"
    },
    {
      "type": "text",
      "id": "blog",
      "label": "Blog Handle",
      "default": "news",
      "info": "The handle of the blog to pull articles from (e.g. 'news')"
    },
    {
      "type": "range",
      "id": "articles_count",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "Number of Articles"
    }
  ],
  "presets": [
    {
      "name": "Research Articles"
    }
  ]
}
{% endschema %}
