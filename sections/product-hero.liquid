{% comment %}
  Optibio Product Hero Section — Premium Buy Box
  Two-column: sticky product image + buy box with certifications & social proof
  Brand: Navy #1A2F4D, Gold #C9A961
  Fonts: Sora (headings), Inter (body)
{% endcomment %}

{{ 'product-page.css' | asset_url | stylesheet_tag }}
{{ 'optibio-product-enhancements.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-page.js' | asset_url }}" defer></script>
<script src="{{ 'optibio-product-enhancements.js' | asset_url }}" defer></script>

{% comment %} Preload hero image for LCP performance {% endcomment %}
{% if product.featured_image %}
  <link rel="preload" as="image" href="{{ product.featured_image | image_url: width: 800 }}" fetchpriority="high">
{% endif %}

{% comment %} Preload fonts {% endcomment %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<section class="optibio-section optibio-hero" id="optibio-hero" data-section-id="{{ section.id }}">

  {% comment %} Trust Bar removed — duplicates announcement bar + certification pills {% endcomment %}

  <div class="optibio-hero__container page-width">

    {% comment %} Left: Product Image Gallery (sticky on desktop) {% endcomment %}
    <div class="optibio-hero__media">
      {% for media in product.media %}
        {% if media.media_type == 'image' %}
          <div class="optibio-hero__media-item {% if forloop.first %}active{% endif %}"
               data-media-index="{{ forloop.index0 }}">
            {% if forloop.first %}
              {{ media | image_url: width: 800 | image_tag:
                class: 'optibio-hero__image',
                loading: 'eager',
                fetchpriority: 'high',
                alt: media.alt | default: product.title,
                widths: '400, 600, 800, 1200',
                sizes: '(min-width: 768px) 45vw, 100vw'
              }}
            {% else %}
              {{ media | image_url: width: 800 | image_tag:
                class: 'optibio-hero__image',
                loading: 'lazy',
                alt: media.alt | default: product.title,
                widths: '400, 600, 800',
                sizes: '(min-width: 768px) 45vw, 100vw'
              }}
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}

      {% comment %} Thumbnail Strip {% endcomment %}
      {% if product.media.size > 1 %}
      <div class="optibio-hero__thumbnails">
        {% assign thumb_index = 0 %}
        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            <button class="optibio-hero__thumb {% if thumb_index == 0 %}active{% endif %}"
                    data-thumb-index="{{ thumb_index }}"
                    type="button"
                    aria-label="View image {{ forloop.index }}">
              {{ media | image_url: width: 120 | image_tag: loading: 'lazy', alt: '' }}
            </button>
            {% assign thumb_index = thumb_index | plus: 1 %}
          {% endif %}
        {% endfor %}
      </div>
      {% endif %}
    </div>

    {% comment %} Right: Buy Box {% endcomment %}
    <div class="optibio-hero__details">

      {% comment %} Subtitle badge {% endcomment %}
      <div class="optibio-hero__subtitle-badge">
        Science-Backed &middot; Third-Party Tested &middot; Made in USA
      </div>

      <h1 class="optibio-hero__heading">{{ section.settings.heading }}</h1>
      <p class="optibio-hero__subheading">{{ section.settings.subheading }}</p>

      {% comment %} Certification Trust Badges with "Verified" status {% endcomment %}
      <div class="optibio-hero__certifications">
        <div class="optibio-cert-badge">
          <svg class="optibio-cert-badge__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
          <span>Third-Party Tested</span>
          <span class="optibio-cert-badge__check"><svg viewBox="0 0 12 12"><polyline points="2 6 5 9 10 3"></polyline></svg></span>
        </div>
        <div class="optibio-cert-badge">
          <svg class="optibio-cert-badge__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
          <span>GMP Certified</span>
          <span class="optibio-cert-badge__check"><svg viewBox="0 0 12 12"><polyline points="2 6 5 9 10 3"></polyline></svg></span>
        </div>
        <div class="optibio-cert-badge">
          <svg class="optibio-cert-badge__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
          <span>Non-GMO</span>
          <span class="optibio-cert-badge__check"><svg viewBox="0 0 12 12"><polyline points="2 6 5 9 10 3"></polyline></svg></span>
        </div>
        <div class="optibio-cert-badge">
          <svg class="optibio-cert-badge__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          <span>FDA-Audited Facility</span>
          <span class="optibio-cert-badge__check"><svg viewBox="0 0 12 12"><polyline points="2 6 5 9 10 3"></polyline></svg></span>
        </div>
        <div class="optibio-cert-badge">
          <svg class="optibio-cert-badge__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
          <span>Award-Winning</span>
          <span class="optibio-cert-badge__check"><svg viewBox="0 0 12 12"><polyline points="2 6 5 9 10 3"></polyline></svg></span>
        </div>
        <div class="optibio-cert-badge">
          <svg class="optibio-cert-badge__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a9 9 0 1 0 9 9"></path><path d="M12 3c1.5 2 2.5 5 2.5 9"></path><path d="M12 3c-1.5 2-2.5 5-2.5 9s1 7 2.5 9"></path><line x1="3" y1="12" x2="21" y2="12"></line></svg>
          <span>Halal Certified</span>
          <span class="optibio-cert-badge__check"><svg viewBox="0 0 12 12"><polyline points="2 6 5 9 10 3"></polyline></svg></span>
        </div>
      </div>

      {% comment %} Benefit Bullets {% endcomment %}
      <ul class="optibio-hero__benefits">
        <li><span class="check">&#10003;</span> {{ section.settings.benefit_1 }}</li>
        <li><span class="check">&#10003;</span> {{ section.settings.benefit_2 }}</li>
        <li><span class="check">&#10003;</span> {{ section.settings.benefit_3 }}</li>
      </ul>

      {% comment %} Social Proof Widget — placeholder for Judge.me real reviews {% endcomment %}
      <div id="judgeme_product_reviews" class="jdgm-widget jdgm-preview-badge" data-id="{{ product.id }}">
        {{ product.metafields.judgeme.badge }}
      </div>

      {% comment %} CRO: Low Stock Indicator — real inventory data only {% endcomment %}
      {% assign current_variant = product.selected_or_first_available_variant %}
      {% if current_variant.inventory_quantity > 0 and current_variant.inventory_quantity < 50 %}
        <div class="optibio-hero__low-stock">
          <span class="optibio-low-stock__dot"></span>
          Only {{ current_variant.inventory_quantity }} left in stock — order soon
        </div>
      {% endif %}

      {% comment %} Render buy box (bundle selector, subscription, price summary, ATC) {% endcomment %}
      {% render 'optibio-enhanced-buy-box' %}

      {% comment %} Shopify product form (hidden, synced by JS for cart API) {% endcomment %}
      {% form 'product', product, id: 'optibio-product-form', novalidate: 'novalidate', data-product-form: '' %}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        <input type="hidden" name="selling_plan" id="optibio-selling-plan-input" value="">
      {% endform %}

      {% comment %} Selling plan data for JS (from Shopify native Subscriptions) {% endcomment %}
      {% if product.selling_plan_groups.size > 0 %}
        <script id="optibio-selling-plan-data" type="application/json">
          {
            "groups": [
              {% for group in product.selling_plan_groups %}
                {
                  "id": "{{ group.id }}",
                  "name": {{ group.name | json }},
                  "plans": [
                    {% for plan in group.selling_plans %}
                      {
                        "id": {{ plan.id }},
                        "name": {{ plan.name | json }}
                      }{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                  ]
                }{% unless forloop.last %},{% endunless %}
              {% endfor %}
            ]
          }
        </script>
      {% endif %}

      {% comment %} Express Checkout (inside buy box flow) {% endcomment %}
      <div class="optibio-hero__express-checkout">
        {%- form 'product', product, id: 'optibio-express-checkout-form' -%}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {{ form | payment_button }}
        {%- endform -%}
      </div>
    </div>

  </div>

  {% comment %} Sticky Cart Bar (appears on scroll) {% endcomment %}
  {% render 'product-sticky-cart' %}

</section>

{% schema %}
{
  "name": "Optibio Hero",
  "tag": "section",
  "class": "optibio-hero-wrapper",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Hero Heading",
      "default": "Feel Calm Again."
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheadline",
      "default": "Clinically studied KSM-66\u00ae ashwagandha for stress, sleep, and mental clarity."
    },
    {
      "type": "text",
      "id": "benefit_1",
      "label": "Benefit 1",
      "default": "27.9% cortisol reduction\u00b9"
    },
    {
      "type": "text",
      "id": "benefit_2",
      "label": "Benefit 2",
      "default": "Sleep efficiency improved to 83.5%\u00b2"
    },
    {
      "type": "text",
      "id": "benefit_3",
      "label": "Benefit 3",
      "default": "90-day money-back guarantee"
    },
    {
      "type": "checkbox",
      "id": "show_trust_bar",
      "label": "Show Trust Bar",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Optibio Hero"
    }
  ]
}
{% endschema %}
